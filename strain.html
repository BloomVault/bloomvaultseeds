<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Strain · BloomVault Farms</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
<header class="bv-header">
  <div class="bv-wrap">
    <div class="bv-logo">
      <a class="brand" href="index.html" aria-label="BloomVault Farms">
        <img src="assets/img/logo.png" alt="BloomVault Farms">
      </a>
    </div>
    <!-- hidden by CSS, but kept for structure -->
    <div class="bv-cartchip">Cart <span class="bv-badge" data-cart-count>0</span></div>
  </div>
  <nav class="bv-tabs" aria-label="Primary">
    <a href="index.html">Home</a>
    <a href="catalogue.html">Seed Catalogue</a>
    <a href="about.html">About</a>
    <a href="compliance.html">Compliance &amp; FAQ</a>
    <a href="cart.html">Cart <span class="tab-badge" data-cart-tab-count>0</span></a>
  </nav>
</header>

<div id="seed-rain-banner" aria-hidden="true"></div>

<section class="container" style="margin-top:14px">
  <h1 class="page-title" id="s-title">Strain</h1>

  <div class="bv-card" style="display:grid; grid-template-columns: 1fr; gap:12px; padding-bottom:10px">
    <div class="card-image" id="s-image" style="max-width:460px; margin:0 auto 6px">
      <div class="coming-soon">COMING SOON</div>
    </div>

    <div class="card-body">
      <div class="ph-sub" id="s-availability">—</div>
      <div class="ph-sub" id="s-price" style="margin:6px 0 10px">Price: —</div>

      <div class="grid-2" style="display:grid;gap:10px;grid-template-columns:repeat(2,minmax(0,1fr))">
        <div class="card" style="padding:10px">
          <strong>Seed Type</strong>
          <div id="s-type" class="muted">—</div>
        </div>
        <div class="card" style="padding:10px">
          <strong>Flower Type</strong>
          <div id="s-flower" class="muted">—</div>
        </div>
        <div class="card" style="padding:10px">
          <strong>Flavors</strong>
          <div id="s-flavors" class="muted">—</div>
        </div>
        <div class="card" style="padding:10px">
          <strong>Lineage</strong>
          <div id="s-lineage" class="muted">—</div>
        </div>
      </div>

      <div class="card" style="padding:10px; margin-top:10px">
        <strong>Notes</strong>
        <p id="s-notes" class="muted" style="margin:6px 0 0">—</p>
      </div>

      <div class="card-cta" style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
        <a class="btn" href="catalogue.html">Back to Catalogue</a>
        <button class="btn" type="button" id="s-add-btn" disabled>Add</button>
      </div>
    </div>
  </div>
</section>

<footer class="site-footer">
  <div class="container">
    <p>© <span id="year"></span> BloomVault Farms — Premium Genetics, Curated with Care.</p>
  </div>
</footer>

<!-- EmailJS then app.js (must be in this order) -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script> emailjs.init({ publicKey: "Iph-DFQJujXfJ_gni" }); </script>
<script defer src="assets/js/app.js?v=10"></script>

<script>
  // Robustly wait for window.PRODUCTS (set in app.js) before populating
  function fillFromProducts() {
    const params = new URLSearchParams(location.search);
    const id = params.get('id');

    const list = (window.PRODUCTS || []);
    const p = list.find(x => x.id === id);

    if(!p){
      document.getElementById('s-title').textContent = 'Strain Not Found';
      return;
    }

    // Title & basic fields
    document.getElementById('s-title').textContent = p.name || 'Strain';
    document.getElementById('s-availability').textContent = p.available ? 'Available' : 'Coming Soon';
    document.getElementById('s-price').textContent = 'Price: ' + (p.price == null ? '—' : ('$' + Number(p.price).toFixed(2)));
    document.getElementById('s-type').textContent = p.type || '—';
    document.getElementById('s-flower').textContent = p.flower_type || '—';
    document.getElementById('s-flavors').textContent = p.flavors || '—';
    document.getElementById('s-lineage').textContent = p.lineage || '—';
    document.getElementById('s-notes').textContent = p.notes || '—';

    // Image (or keep COMING SOON)
    const imgWrap = document.getElementById('s-image');
    if (p.img){
      imgWrap.innerHTML = `<img src="${p.img}" alt="${p.name}" style="width:100%;height:100%;object-fit:cover">`;
    }

    // Enable Add (uses shared pack modal from app.js)
    const addBtn = document.getElementById('s-add-btn');
    if(p.available){
      addBtn.disabled = false;
      addBtn.addEventListener('click', ()=>{
        if (typeof openPackModal === 'function') openPackModal(p);
      });
    }
  }

  // Wait until PRODUCTS is ready (handles race conditions)
  (function waitForProducts(tries = 0){
    if (Array.isArray(window.PRODUCTS) && window.PRODUCTS.length){
      fillFromProducts();
      return;
    }
    if (tries > 60){ // ~3s @ 50ms interval
      document.getElementById('s-title').textContent = 'Strain';
      return;
    }
    setTimeout(()=> waitForProducts(tries + 1), 50);
  })();
</script>
</body>
</html>
